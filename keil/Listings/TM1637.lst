C51 COMPILER V9.60.7.0   TM1637                                                            06/30/2024 23:16:02 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TM1637
OBJECT MODULE PLACED IN .\Objects\TM1637.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE TM1637.c OPTIMIZE(8,SPEED) BROWSE INCDIR(D:\Keil_v5\C51\INC\Atmel) DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\TM1637.lst) TABS(2) OBJECT(.\Objects\TM1637.obj)

line level    source

   1          #include "TM1637.h"
   2          
   3          /**
   4           * @description: 开始
   5           * @return {*}
   6           */
   7          void startTM1637()
   8          {
   9   1        SCL = 1;
  10   1        SDA = 1;
  11   1        SDA = 0;
  12   1        SCL = 0;
  13   1      }
  14          
  15          /**
  16           * @description: 向TM1637传输一字节数据
  17           * @param {uchar} dat
  18           * @return {*}
  19           */
  20          void writeTM1637(uchar dat)
  21          {
  22   1        uchar i = 0;
  23   1        for (; i < 8; i++)
  24   1        {
  25   2          SDA = dat & 1; // 低在前
  26   2          SCL = 1;
  27   2          SCL = 0;
  28   2          dat >>= 1;
  29   2        }
  30   1      }
  31          
  32          /**
  33           * @description: 等待TM1637应答
  34           * @return {*}
  35           */
  36          void ackTM1637()
  37          {
  38   1        // while (SDA)
  39   1        // {
  40   1        //  buzzer = 0;
  41   1        //  delay1ms(200);
  42   1        //  buzzer = 1;
  43   1        //  delay1ms(200);
  44   1        // }
  45   1        buzzer = 1;
  46   1        SCL = 1;
  47   1        SCL = 0;
  48   1      }
  49          
  50          /**
  51           * @description: 停止
  52           * @return {*}
  53           */
  54          void stopTM1637()
C51 COMPILER V9.60.7.0   TM1637                                                            06/30/2024 23:16:02 PAGE 2   

  55          {
  56   1        SCL = 0;
  57   1        SDA = 0;
  58   1        SCL = 1;
  59   1        SDA = 1;
  60   1      }
  61          
  62          /**
  63           * @description: 读取按键
  64           * @return {uchar} key
  65           */
  66          uchar keyTM1637()
  67          {
  68   1        uchar key = 0, i = 0, temp = 0;
  69   1        startTM1637();
  70   1        writeTM1637(0x42);
  71   1        ackTM1637();
  72   1        SDA = 1;
  73   1        for (; i < 8; i++)
  74   1        {
  75   2          temp >>= 1;
  76   2          SCL = 1;
  77   2          if (SDA)
  78   2            temp |= 0x80;
  79   2          SCL = 0;
  80   2        }
  81   1        ackTM1637();
  82   1        stopTM1637();
  83   1      
  84   1        switch (temp)
  85   1        {
  86   2        case 0xFF:
  87   2          key = 0;
  88   2          break;
  89   2        case 0xF7:
  90   2          key = 1;
  91   2          break;
  92   2        case 0xF6:
  93   2          key = 2;
  94   2          break;
  95   2        case 0xF5:
  96   2          key = 3;
  97   2          break;
  98   2        case 0xF4:
  99   2          key = 4;
 100   2          break;
 101   2        case 0xF3:
 102   2          key = 5;
 103   2          break;
 104   2        default:
 105   2          key = 6;
 106   2          break;
 107   2        }
 108   1        return key;
 109   1      }
 110          
 111          /**
 112           * @description: 设置亮度
 113           * @param {uchar} luminance 亮度
 114           * @return {*}
 115           */
 116          void setluminanceTM1637(uchar luminance)
C51 COMPILER V9.60.7.0   TM1637                                                            06/30/2024 23:16:02 PAGE 3   

 117          {
 118   1        uchar temp = 0;
 119   1        if (luminance)
 120   1          temp = (luminance - 1) | 0x88;
 121   1        else
 122   1          temp = 0x80;
 123   1      
 124   1        startTM1637();
 125   1        writeTM1637(temp);
 126   1        ackTM1637();
 127   1        stopTM1637();
 128   1      }
 129          
 130          /**
 131           * @description: 数码管显示
 132           * @param {uchar} grid 位置
 133           * @param {uchar} sg   显示码
 134           * @return {*}
 135           */
 136          void displayTM1637(uchar grid, uchar sg)
 137          {
 138   1        startTM1637();
 139   1        writeTM1637(0x44);
 140   1        ackTM1637();
 141   1        stopTM1637();
 142   1      
 143   1        startTM1637();
 144   1        writeTM1637((grid - 1) | 0xC0);
 145   1        ackTM1637();
 146   1        writeTM1637(sg);
 147   1        ackTM1637();
 148   1        stopTM1637();
 149   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    211    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

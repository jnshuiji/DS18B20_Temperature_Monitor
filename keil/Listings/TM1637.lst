C51 COMPILER V9.60.7.0   TM1637                                                            06/29/2024 20:57:53 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TM1637
OBJECT MODULE PLACED IN .\Objects\TM1637.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE TM1637.c OPTIMIZE(8,SPEED) BROWSE INCDIR(D:\Keil_v5\C51\INC\Atmel) DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\TM1637.lst) TABS(2) OBJECT(.\Objects\TM1637.obj)

line level    source

   1          /*
   2           * @Author: Quan Si
   3           * @Date: 2024-05-23 16:49:56
   4           * @LastEditTime: 2024-06-29 20:57:49
   5           * @LastEditors: Quan Si
   6           * @Description: TM1637驱动程序
   7           * @FilePath: \keil\TM1637.c
   8           */
   9          #include "TM1637.h"
  10          
  11          /**
  12           * @description: 开始
  13           * @return {*}
  14           */
  15          void startTM1637()
  16          {
  17   1        SCL = 1;
  18   1        _nop_();
  19   1        _nop_();
  20   1        SDA = 1;
  21   1        _nop_();
  22   1        _nop_();
  23   1        SDA = 0;
  24   1        _nop_();
  25   1        _nop_();
  26   1        SCL = 0;
  27   1      }
  28          
  29          /**
  30           * @description: 向TM1637传输一字节数据
  31           * @param {uchar} dat
  32           * @return {*}
  33           */
  34          void writeTM1637(uchar dat)
  35          {
  36   1        uchar i = 0;
  37   1        for (; i < 8; i++)
  38   1        {
  39   2          _nop_();
  40   2          _nop_();
  41   2          SDA = dat & 1; // 低在前
  42   2          SCL = 1;
  43   2          _nop_();
  44   2          _nop_();
  45   2          SCL = 0;
  46   2          dat >>= 1;
  47   2        }
  48   1      }
  49          
  50          /**
  51           * @description: 等待TM1637应答
  52           * @return {*}
  53           */
  54          void ackTM1637()
C51 COMPILER V9.60.7.0   TM1637                                                            06/29/2024 20:57:53 PAGE 2   

  55          {
  56   1        _nop_();
  57   1        _nop_();
  58   1        _nop_();
  59   1        _nop_();
  60   1        _nop_();
  61   1        while (SDA)
  62   1        {
  63   2          buzzer = 0;
  64   2        }
  65   1        buzzer = 1;
  66   1        SCL = 1;
  67   1        _nop_();
  68   1        _nop_();
  69   1        SCL = 0;
  70   1      }
  71          
  72          /**
  73           * @description: 停止
  74           * @return {*}
  75           */
  76          void stopTM1637()
  77          {
  78   1        SCL = 0;
  79   1        _nop_();
  80   1        _nop_();
  81   1        SDA = 0;
  82   1        _nop_();
  83   1        _nop_();
  84   1        SCL = 1;
  85   1        _nop_();
  86   1        _nop_();
  87   1        SDA = 1;
  88   1      }
  89          
  90          /**
  91           * @description: 读取按键
  92           * @return {uchar} key
  93           */
  94          uchar keyTM1637()
  95          {
  96   1        uchar key = 0, i = 0, temp = 0;
  97   1        startTM1637();
  98   1        writeTM1637(0x42);
  99   1        ackTM1637();
 100   1        SDA = 1;
 101   1        for (; i < 8; i++)
 102   1        {
 103   2          temp >>= 1;
 104   2          _nop_();
 105   2          SCL = 1;
 106   2          if (SDA)
 107   2            temp |= 0x80;
 108   2          _nop_();
 109   2          SCL = 0;
 110   2          _nop_();
 111   2        }
 112   1        ackTM1637();
 113   1        stopTM1637();
 114   1      
 115   1        switch (temp)
 116   1        {
C51 COMPILER V9.60.7.0   TM1637                                                            06/29/2024 20:57:53 PAGE 3   

 117   2        case 0xFF:
 118   2          key = 0;
 119   2          break;
 120   2        case 0xF7:
 121   2          key = 1;
 122   2          break;
 123   2        case 0xF6:
 124   2          key = 2;
 125   2          break;
 126   2        case 0xF5:
 127   2          key = 3;
 128   2          break;
 129   2        case 0xF4:
 130   2          key = 4;
 131   2          break;
 132   2        case 0xF3:
 133   2          key = 5;
 134   2          break;
 135   2        default:
 136   2          key = 6;
 137   2          break;
 138   2        }
 139   1        return key;
 140   1      }
 141          
 142          /**
 143           * @description: 设置亮度
 144           * @param {uchar} luminance 亮度
 145           * @return {*}
 146           */
 147          void setluminanceTM1637(uchar luminance)
 148          {
 149   1        uchar temp = 0;
 150   1        if (luminance)
 151   1          temp = (luminance - 1) | 0x88;
 152   1        else
 153   1          temp = 0x80;
 154   1      
 155   1        startTM1637();
 156   1        writeTM1637(temp);
 157   1        ackTM1637();
 158   1        stopTM1637();
 159   1      }
 160          
 161          /**
 162           * @description: 数码管显示
 163           * @param {uchar} grid 位置
 164           * @param {uchar} sg   显示码
 165           * @return {*}
 166           */
 167          void displayTM1637(uchar grid, uchar sg)
 168          {
 169   1        startTM1637();
 170   1        writeTM1637(0x44);
 171   1        ackTM1637();
 172   1        stopTM1637();
 173   1      
 174   1        startTM1637();
 175   1        writeTM1637((grid - 1) | 0xC0);
 176   1        ackTM1637();
 177   1        writeTM1637(sg);
 178   1        ackTM1637();
C51 COMPILER V9.60.7.0   TM1637                                                            06/29/2024 20:57:53 PAGE 4   

 179   1        stopTM1637();
 180   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    244    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
